@inject MasaBlazor MasaBlazor
@inject LocalStorage LocalStorage
@inject IJSRuntime JSRuntime
@inject IThemeService ThemeService
@implements IDisposable

<AppTooltipButton Icon="@(ThemeService.Dark ? "mdi-weather-night" : "mdi-weather-sunny")"
                  Path="toggle-theme"
                  Class="mr-2 ml-2"
                  OnClick="@SwitchTheme">
</AppTooltipButton>

@code {

    private DotNetObjectReference<ThemeToggle>? _objRef;

    protected override void OnInitialized()
    {
        _objRef = DotNetObjectReference.Create(this);
    }

    public void SwitchTheme(MouseEventArgs e)
    {
        _ = JSRuntime.InvokeVoidAsync("switchTheme", _objRef, !ThemeService.Dark, e.ClientX, e.ClientY);
    }

    [JSInvokable]
    public void ToggleTheme(bool dark)
    {
        ThemeService.Dark = dark;

        _ = LocalStorage.SetItemAsync("masablazor@theme", dark ? "dark" : "light");

        _ = JSRuntime.TryInvokeVoidAsync("updateThemeOfElementsFromMarkdown", dark);
    }

    public void Dispose()
    {
        _objRef?.Dispose();
    }

}